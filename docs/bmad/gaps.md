# 不足点・未決定事項（BMAD Methodの観点）

このリストは「仕様として決める必要があること」を集約します。決まったものは `docs/bmad/spec-current.md` に反映してここはクローズします。

## 最優先（混在/事故につながる）
- [ ] **ユーザー識別/マルチユーザー方針**: 現状は `LINE_USER_ID` にPushする運用前提だが、webhookの `source.userId` とどう紐付けるか（複数ユーザー対応する/しない、いつする）
- [ ] **認証/認可**: `/api/line/push` や cron/job を誰が叩ける想定か（署名検証、管理者トークン、IP制限など）
- [ ] **LINE webhook署名検証**: `x-line-signature` を検証していない（なりすまし/リプレイ耐性をどうするか）

## 仕様の穴（状態/遷移/整合性）
- [ ] **Goalのstatus遷移定義**: `pending/approved/archived` をいつ/誰が/どう更新するか（現状は追加のみ）
- [ ] **Taskのstatus語彙の固定**: `todo/done/miss` 以外を許すか、missの再スケジュール概念を持つか
- [ ] **タスク選定ロジック**: 朝の命令は todoの先頭1件だが、優先度/期限/作成順のどれが正か
- [ ] **重複生成の扱い**: `#タスク整理` を同じログに対して複数回実行したい/したくない（現状はanalysis済みだと拒否）

## UX/会話仕様
- [ ] **コマンド一覧と正しい文言の統一**: webhook内の `COMMAND_REPLY` と実際のデフォルトキーワードが食い違っている（例: #ログ開始/#ログ終了 と #整理開始/#整理終了）
- [ ] **日報での入力例/エラーメッセージ整備**: taskIdの提示/コピペしやすさ、失敗時の再試行導線
- [ ] **postbackの仕様範囲**: `approve_goal:` 以外（延期/完了ボタンなど）を追加するか

## 非機能（運用/信頼性/コスト）
- [ ] **DeepSeek失敗時の期待動作**: リトライ方針、ユーザーへのメッセージ、部分成功（ログ保存だけする等）
- [ ] **Google Sheetsの上限/運用**: 行数増加時のパフォーマンス、バックアップ、スキーマ変更手順
- [ ] **PII/ログ方針**: DeepSeek HTTPログを有効化した際に何を残すか、マスキングの要否
- [ ] **時刻/タイムゾーン**: CronのUTC/JST、logsのtimestampの扱い

## テスト/品質ゲート
- [ ] **受入条件（Given/When/Then）**: 最低限の主要フロー（思考ログ→タスク化→日報→週次）
- [ ] **モック戦略**: LINE/DeepSeek/Sheets の契約テスト or 疑似実装
- [ ] **回帰観点**: キーワード変更やプロンプト変更で壊れやすい箇所の固定（ゴールデンテキスト等）
