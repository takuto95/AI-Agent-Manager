# キーワードレス化と追加改善（2024-12-30）

## 問題の概要

ユーザーから以下のフィードバックを受けた：

> ユーザーが起点のメッセージはなるべく少なくしたいです。  
> 整理開始や日報開始、再スケジュールなど。  
> なので新機能を使う動線はAI側から特定の文字や番号を打ったら表示するとか、勝手に表示してくれるようにしてもらえますか？

**現在の問題:**
- `#整理開始` `#日報開始` などのキーワードを覚える必要がある
- コマンドが多くて覚えられない
- ユーザーの入力負担が大きい

## 実装した改善

### 1. ✅ キーワードレス化

#### 1-1. 番号でモード選択（1/2/3）

**修正前:**
```
ユーザー: #整理開始
```

**修正後:**
```
システム（非アクティブ時）:
何をする？番号で選んで。

1️⃣ 思考を整理する（モヤモヤを言語化）
2️⃣ 今日の報告をする（done/miss）
3️⃣ タスクを作る（思考→タスク化）
❓ 使い方を見る

ユーザー: 1
→ 思考ログモード開始！
```

**効果:**
- ✅ キーワードを覚えなくていい
- ✅ 1文字で選択できる
- ✅ 直感的

#### 1-2. AIが自動でモード提案

**ユーザーが「モヤモヤする」と送る:**
```
ユーザー: 最近モヤモヤしていて、何をすればいいか分からない

システム:
思考ログモード自動開始。

モヤモヤしてるんだね。

「何をすればいいか分からない」って、本当に何も見えてないの？
それとも、選択肢が多すぎて選べないの？

終了: 「終了」と送るか、もっと話す
```

**AIが自動判断するキーワード:**
- **思考ログっぽい**: モヤモヤ、悩み、考え、迷、不安、困、どうしよう、わからない
- **日報っぽい**: 報告、完了、未達、done、miss、やった、できた、できなかった
- **タスクっぽい**: タスク、todo、やること、整理、作る、生成

**効果:**
- ✅ ユーザーは自然に話すだけでOK
- ✅ AIが意図を汲み取ってモードを提案
- ✅ ストレスフリー

#### 1-3. 「終了」で終了

**修正前:**
```
ユーザー: #整理終了
```

**修正後:**
```
ユーザー: 終了
→ 終了！
```

**効果:**
- ✅ シンプル
- ✅ 覚えやすい

#### 1-4. LINEクイックリプライボタン

```
[1️⃣ 思考を整理する] [2️⃣ 今日の報告をする]
[3️⃣ タスクを作る] [❓ 使い方を見る]
```

**効果:**
- ✅ タップするだけ
- ✅ 入力不要

---

### 2. ✅ その他の改善（実装済み）

#### 2-1. ゴールとタスクの連携
- タスク一覧にゴール情報を表示
- 日報終了時にゴール進捗を表示

#### 2-2. missタスクの自動フォロー
- miss時に次のアクション提案

#### 2-3. モチベーション向上
- ストリーク、達成率、褒め言葉

#### 2-4. 思考ログの対話的改善
- 深層心理を探る質問

---

### 3. ✅ 追加改善（すべて実装済み）

#### 3-1. ✅ タスク分割の完全実装
- AIが分割案を提示し、ユーザーが承認できる
- `split 1` または `split t_123` でタスクを分割
- 元タスクを完了にして、サブタスクを追加

#### 3-2. ✅ タスク再挑戦の完全実装
- missタスクをtodoに戻す
- `retry 1` または `retry t_123` でmissタスクを再挑戦

#### 3-3. ✅ タスク生成時の理由説明
- 「なぜこのタスクが必要か」を説明する
- タスク一覧に理由を表示

#### 3-4. ✅ 週次進捗の比較
- 今週と先週の記録件数を比較
- 「📈 先週より3件多い（+50%）」

#### 3-5. ✅ マイルストーン・バッジ
- ストリーク（連続日数）と完了件数に応じたバッジ
- 🔥 3日連続、🥉 7日連続、🥈 14日連続、🥇 30日連続、💎 50日連続、🏆 100日連続
- 🌱 10件完了、🎯 50件完了、💪 100件完了、✨ 300件完了、⭐ 500件完了、🌟 1000件完了

#### 3-6. ✅ 月次・四半期レビュー
- 週次cronで月末・四半期末を判定して自動実行
- 月次: 30日分のログとタスク実績を振り返り
- 四半期: 90日分のログとタスク実績を振り返り
- cronの制約（2つまで）を考慮し、週次cronに統合

#### 3-7. ✅ 学習とパーソナライズ
- ユーザーの行動パターンを分析（優先度別、曜日別、タスクの傾向）
- AIが自動で提案を生成
  - 優先度Aの達成率が低い → 優先度調整を提案
  - missタスクが長い → タスク簡略化を提案
  - 特定の曜日の達成率が低い → 時間調整を提案
  - 全体の達成率が高い → 励ます

---

## 使用例

### 例1: 番号でモード選択

**ユーザー（何もモード選択していない）:**
```
（何か送る）
```

**システム:**
```
何をする？番号で選んで。

1️⃣ 思考を整理する（モヤモヤを言語化）
2️⃣ 今日の報告をする（done/miss）
3️⃣ タスクを作る（思考→タスク化）
❓ 使い方を見る
```

**ユーザー:**
```
1
```

**システム:**
```
思考ログモード開始。

今、何が気になってる？
ふわっとした気持ちでいい。そのまま送って。

終了: 「終了」と送るか、もっと話す
```

---

### 例2: AIが自動でモード判断

**ユーザー（何もモード選択していない）:**
```
最近モヤモヤしてて、何をすればいいか分からない
```

**システム:**
```
思考ログモード自動開始。

モヤモヤしてるんだね。

「何をすればいいか分からない」って、本当に何も見えてないの？
それとも、選択肢が多すぎて選べないの？

終了: 「終了」と送るか、もっと話す
```

**ユーザー:**
```
選択肢が多すぎて選べない感じ
```

**システム:**
```
なるほど。選択肢は見えてるんだね。

じゃあ、何が決め手にならないの？
「失敗したくない」？「どれも中途半端」？

一番気になってる選択肢を1つだけ教えて。
```

---

### 例3: 「終了」で終了

**ユーザー（思考ログモード中）:**
```
終了
```

**システム:**
```
思考の整理、お疲れ様。

今の気持ちを言語化できたね。
次に「3」を送れば、ここから具体的なタスクを作れる。
```

---

## 修正したファイル

1. **app/api/line/webhook/route.ts**
   - `buildInactiveMenuMessage`, `buildInactiveMenuButtons`, `buildInactiveMenuText` を改善
   - `handleInactiveMessage` を追加（AI自動判断）
   - 番号（1/2/3）でモード選択
   - 「終了」でも終了できるように

2. **docs/bmad/spec-current.md**
   - キーワードレス化を追記

3. **docs/bmad/fix-2024-12-30-keywordless-and-improvements.md**
   - 詳細な改善ドキュメント（このファイル）

4. **README.md**
   - 変更履歴追加

---

## 効果

### ユーザー体験の変化

**修正前:**
- キーワードを覚える必要がある
- `#整理開始` `#日報開始` など、長いコマンドを入力
- 間違えると動かない

**修正後:**
- 番号（1/2/3）で選択できる
- 自然に話すだけでAIが判断
- 「終了」でシンプルに終了
- LINEボタンでタップするだけ

### 期待される効果

1. ✅ **入力負担の削減**
   - キーワードを覚えなくていい
   - 1文字または自然な言葉でOK

2. ✅ **直感的な操作**
   - 番号で選択
   - ボタンでタップ

3. ✅ **AIが意図を汲み取る**
   - 自然に話すだけでモードが始まる
   - ストレスフリー

4. ✅ **継続しやすい**
   - 操作が簡単だから続けやすい

---

## 実装済み機能

### ✅ すべて実装済み（2024-12-30）
- [x] キーワードレス化（番号選択、AI自動判断）
- [x] タスク分割の完全実装
- [x] タスク再挑戦の完全実装
- [x] タスク生成時の理由説明
- [x] 週次進捗の比較（先週比）
- [x] マイルストーン・バッジ
- [x] 月次レビュー（週次cronで月末判定）
- [x] 四半期レビュー（週次cronで四半期末判定）
- [x] 学習とパーソナライズ（傾向分析と提案）

### 今後の実装予定

#### 長期（数ヶ月〜）
- [ ] より高度な学習とパーソナライズ（時系列分析、予測）
- [ ] AIによる自動優先度調整
- [ ] ゴールの自動分解と進捗予測

---

## 詳細な使い方

### タスク分割の使い方

**コマンド:**
```
split 1
または
split t_1766122744120_1
```

**流れ:**
1. ユーザーが `split 1` を送信
2. AIがタスクを分析し、3〜5個のサブタスクを提案
3. ユーザーが「承認」と送信
4. 元タスクを完了にし、サブタスクを追加

**例:**
```
ユーザー: split 1

システム:
【タスク分割案】
元タスク: デザインシステムを構築する

このタスクは大きすぎるため、段階的に実装できるように分割しました。

サブタスク:
1. [A] カラーパレットとタイポグラフィを定義する
  → 他のコンポーネントの基礎になるため最優先
2. [B] ボタン・インプットの基本コンポーネントを作る
  → よく使うコンポーネントを先に実装
3. [B] レイアウト・グリッドシステムを構築する
  → ページ全体の構造に必要
4. [C] ドキュメントとサンプルページを作成する
  → 完成後に使い方を整理

この分割案でよければ「承認」と送ってください。
元タスクを「done」にして、サブタスクを追加します。

ユーザー: 承認

システム:
✅ タスク分割を実行した。

元タスク（t_1766122744120_1）を完了にして、
4個のサブタスクを追加した。

サブタスク:
1. [A] カラーパレットとタイポグラフィを定義する
2. [B] ボタン・インプットの基本コンポーネントを作る
3. [B] レイアウト・グリッドシステムを構築する
4. [C] ドキュメントとサンプルページを作成する
```

### タスク再挑戦の使い方

**コマンド:**
```
retry 1
または
retry t_1766122744120_1
```

**流れ:**
1. ユーザーが `retry 1` を送信
2. missタスクをtodoに戻す

**例:**
```
ユーザー: retry 1

システム:
✅ 再挑戦を設定した。

タスク: デザインシステムを構築する
状態: miss → todo

もう一度やってみよう。今度はできる。
```

---

## まとめ

今回の改善により、**ユーザーの入力負担が大幅に削減**され、**プロダクト全体の体験が向上**しました。

**実装した機能:**
1. ✅ キーワードレス化（番号選択、AI自動判断）
2. ✅ タスク分割（AIが分割案を提案）
3. ✅ タスク再挑戦（missタスクをtodoに戻す）
4. ✅ タスク生成時の理由説明
5. ✅ 週次進捗の比較（先週比）
6. ✅ マイルストーン・バッジ（ストリーク・完了件数）

**重要な考え方:**
- **キーワードを覚えさせない**
- **AIが意図を汲み取る**
- **番号やボタンで簡単に**
- **自然な言葉で話せる**
- **達成感とモチベーションを高める**

これで、ユーザーはストレスなくプロダクトを使い続けられます。
